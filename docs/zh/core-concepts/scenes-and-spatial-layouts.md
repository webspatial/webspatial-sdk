
# 场景和空间布局

## 场景

[空间应用](#)是由「**场景（Scene）**」组成的。

场景是一种由空间计算操作系统在共享空间中统一管理的内容容器，应用的所有内容都要放在一到多个这样的容器里。

| ![](../../assets/concepts/3-1.png) | ![](../../assets/concepts/3-2.png) |
|:---:|:---:|

### 窗口场景

最基础的**场景类型**，就是「**窗口**」。

![](../../assets/concepts/3-3.png)

但跟桌面操作系统里的平面「窗口」不同，空间应用的窗口场景，既可以放 2D 内容，也可以放 3D 内容，它们都基于窗口平面来定位，**可以延伸到窗口平面前方的 3D 空间中**。

![](../../assets/concepts/3-4.png)
![](../../assets/concepts/3-5.png)

空间应用的窗口场景还有一个新能力：窗口的背景和边框可以完全透明，**窗口中的内容好像分散悬浮在空间中**。

![](../../assets/concepts/3-6.png)
![](../../assets/concepts/3-7.png)

### 体积场景

空间应用还能使用一种更 3D 化的场景类型，可以称作**体积场景、空间容器、Volumetric Window 或 Volume**。这种场景是一个有边界的局部 3D 空间，类似一个 3D 包围盒，具备体积。内部既能放 3D 内容，**也能放 2D 内容**。

![](../../assets/concepts/3-8.png)

窗口场景和体积场景虽然都能放 2D 内容和 3D 内容，但前者类似一个**前方有延伸物的面板**，后者类似一个有边界和体积的**物体**，在共享空间中会被操作系统区别对待，跟环境空间做不同的结合，支持用户以不同方式跟它们交互——比如不同的拖拽方式、不同的 [Spatial Layout](#) 模式。

![](../../assets/concepts/3-9.png)
![](../../assets/concepts/3-10.png)

### WebSpatial 应用的场景

WebSpatial 应用同样由这些类型的场景容器组成。

另一方面，这些场景在 WebSpatial 应用中也是加载 URL、解析和运行 HTML 网页的容器，类似一个个浏览器窗口，**场景中的内容都来自其中加载的网页**。

跟浏览器窗口的区别是：不同 WebSpatial 应用的场景，不像浏览器窗口那样都隶属于浏览器应用、被浏览器作为内部的多窗口和多标签页来管理，而是每个 WebSpatial 应用内部都独立拥有自己的一到多个场景，跟原生应用一样。

![](../../assets/concepts/3-11.png)

还有一点跟浏览器窗口不同的是，WebSpatial 应用的场景**没有地址栏、书签、历史等浏览器应用 UI**，整个场景可以设置为透明背景，看不到窗口边框和除了「[场景菜单](#)」之外的原生 UI。

> 对比：左图是没有启用空间化的效果，右图是启用了空间化，把窗口背景设置为全透明。
> | ![](../../assets/concepts/3-12.png) | ![](../../assets/concepts/3-13.png) |
> |:---:|:---:|

## 场景菜单

WebSpatial 应用的一个场景，相当于[已安装的 PWA](#) 运行时的独立窗口。

WebSpatial 应用的场景跟 PWA 的窗口一样，本质是网页，会同样涉及一些网页的通用需求和安全/隐私因素：

- 很多网页不像真正的应用一样具备全功能的导航能力，需要结合「后退/前进」等**原生导航按钮**来使用
- 很多网页在出错的情况下，需要依靠原生的「后退/前进」、「刷新」按钮来重置
- 如果窗口内容来自**动态加载的网页**，用户需要能够查看当前窗口内容对应的网页 URL，确认证书等安全/隐私问题
- 有时，用户需要可以复制当前窗口内容对应的网页 URL，在浏览器中访问，或用于其他用途
- ……

因此 PWA 应用的窗口会包含一些原生 UI，提供安全、网址等通用功能：

![](../../assets/concepts/3-14.png)

PWA 标准在 [Web App Manifest](#) 里提供了 [display 属性](#)，可以用这个 API 对窗口的原生 UI 做一定程度的控制，比如选择**要不要包含原生导航按钮**。

> 下图是桌面平台上 `minimal-ui` 模式的 PWA（有原生顶栏，包含原生导航按钮）
> ![](../../assets/concepts/3-15.png)
>
> 下图是安卓手机上 `minimal-ui` 模式的 PWA（有原生顶栏，其中的菜单里包含原生导航按钮）
> | ![](../../assets/concepts/3-16.png) | ![](../../assets/concepts/3-17.png) |
> |:---:|:---:|
>
> 下图是安卓手机上 `standalone` 模式的 PWA（无原生导航按钮，无原生顶栏，在多任务管理界面上有原生菜单）
> | ![](../../assets/concepts/3-18.png) | ![](../../assets/concepts/3-19.png) |
> |:---:|:---:|

WebSpatial 应用[建立在 PWA 应用的基础上](#)，WebSpatial 应用中的每个场景，都像 PWA 窗口一样，包含一个原生的「**场景菜单**」。

> [!NOTE]
> 目前的 UI 形式是：默认折叠，展开后会提供网址查看和复制、导航按钮（后退、刷新）等功能，具体功能取决于 Web App Manifest 中 display 属性的配置。

![](../../assets/concepts/3-20.png)

## 场景属性

WebSpatial 应用的窗口场景，有一些完全由开发者自主控制的场景属性：

窗口场景的背景平面，可以设置为**半透明**的[材质背景](#)，基于应用周围的空间环境动态渲染，在任何环境背景下都清晰可读容易分辨。还可以把四个角从网页窗口默认的直角改成圆角。

![](../../assets/concepts/3-21.png)

也可以把整个窗口场景的背景改成[全透明](#)材质，无边框，让网页中的内容好像分散漂浮在空中。

![](../../assets/concepts/3-22.png)
![](../../assets/concepts/3-23.png)

可以创建原生 UI，悬浮在窗口边缘，为窗口中的内容提供全局功能（比如作为全局导航栏）。

> [!TIP]
> 当前版本的 WebSpatial 暂不支持这项功能，可以在全透明背景的窗口场景中用 HTML/CSS 来实现这种效果。

| ![](../../assets/concepts/3-24.png) | ![](../../assets/concepts/3-25.png) |
|:---:|:---:|

## 空间布局

在 2D 应用中，UI 和内容的「**布局（Layout）**」决定了各个元素的位置和尺寸大小。

布局是一种「关系」，元素之间会互相影响，一个元素的大小和位置发生变化，可能导致周围很多元素的大小和位置都发生变化。

但是只要 UI 内容没变化，布局就会保持稳定不变，默认是静态的。

在空间应用中，布局不但在「高度」和「宽度」之外，多出了「**深度**」，还增加了一种全新的、**动态的**布局关系——**空间布局（Spatial Layout）**：

由于使用者自身随时在周围空间环境中保持运动状态，比如头部的转动、视角高度的变化（坐下/站起、弯腰）、身体位置和朝向的变化（走动），因此除了 UI 元素之间的静态关系，还多出了 **UI 元素与使用者之间的动态关系**。

UI 元素如何跟随使用者的运动和交互而发生变化，就是「Spatial Layout」。

为了简化和统一实现，空间应用的 Spatial Layout **默认是以场景为单位**的，其他内容都位于场景内，跟随场景而变化，场景跟随着人和环境的变化而变化。

比如场景跟用户的距离发生变化，面向内容阅读的窗口场景可以在用户视野中维持大小不变（近小远大），而模拟真实物体的 Volume 场景则是近大远小。

| ![](../../assets/concepts/3-26.gif) | ![](../../assets/concepts/3-27.gif) |
|:---:|:---:|

## 场景的初始化

场景是由操作系统在[共享空间](#)中统一管理的内容容器。之所以要「统一管理」，是因为在共享空间下，只有操作系统全面理解当前用户所处的环境，了解各个应用中的场景跟用户之间的动态关系（[Spatial Layout](#))，了解各个应用的特点和它们彼此之间的关系。

因此只有操作系统适合最终决定这些场景的尺寸大小、位置、朝向等涉及空间布局（Spatial Layout）的属性。不仅开发者不能**完全**掌控这些属性，甚至终端用户也无法**完全**掌控——不能**随意**拖拽改变窗口大小，也不能把窗口放到**任意**位置，始终受到操作系统的**约束**。

对于这些属性，开发者只能在场景创建之初的初始化环节，提供自己**期望的起始值**，由操作系统来判断是否采纳。

创建之后，这些属性就**无法被代码改变**，只能由操作系统和终端用户的行为来共同决定。

最典型的例子就是场景的[初始大小（`defaultSize`）](#)。

> 快速示例里的例子：
> | ![](../../assets/concepts/3-28.png) | ![](../../assets/concepts/3-29.png) |
> |:---:|:---:|

## 起始场景

WebSpatial 应用的每次启动，总是会先**从单一的场景开始**运行，这个场景就是起始场景（Start Scene），可以通过它打开更多场景。

作为整个 WebSpatial 应用的起始点，起始场景是完全由原生代码（比如 [WebSpatial App Shell](#)）创建和初始化的，**Web 代码是在有了这个起始场景之后才开始运行**。

因此，起始场景的类型和初始化配置，只能在 [Web App Manifest](#) 中管理。

同一个 WebSpatial 应用中后续的更多场景，则是[由 Web 代码来创建，可以在 Web 代码中做初始化配置](#)。

起始场景中加载的 URL，是整个 WebSpatial 应用中加载和运行的第一个 URL。

默认由 Web App Manifest 中的[起始网址（start_url）](#)决定。
而如果通过特定 URL 启动 WebSpatial 应用，起始场景就会加载这个 URL。

> 从快速示例的起始场景中，点击按钮和链接，打开两个新场景：
> ![](../../assets/concepts/3-30.png)

---

下一节：[空间化元素和 3D 容器元素](spatialized-elements-and-3d-container-elements.md)
